<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Fokus Todos Â· Jet Age Cloud</title>
<meta name="theme-color" content="#007AFF">
<style>
:root {
  /* Apple System Colors */
  --sf-blue: #007AFF;
  --sf-blue-dark: #0051D5;
  --sf-green: #34C759;
  --sf-orange: #FF9500;
  --sf-red: #FF3B30;
  --sf-purple: #AF52DE;
  --sf-pink: #FF2D92;
  --sf-yellow: #FFCC00;
  
  /* Apple System Grays */
  --sf-gray-1: #F2F2F7;
  --sf-gray-2: #E5E5EA;
  --sf-gray-3: #D1D1D6;
  --sf-gray-4: #C7C7CC;
  --sf-gray-5: #AEAEB2;
  --sf-gray-6: #8E8E93;
  --sf-gray-7: #636366;
  --sf-gray-8: #48484A;
  --sf-gray-9: #3A3A3C;
  --sf-gray-10: #2C2C2E;
  --sf-gray-11: #1C1C1E;
  
  /* Apple Background Colors */
  --bg-primary: #F2F2F7;
  --bg-secondary: #FFFFFF;
  --bg-tertiary: #F2F2F7;
  --bg-grouped: #F2F2F7;
  --bg-elevated: #FFFFFF;
  
  /* Apple Text Colors */
  --text-primary: #000000;
  --text-secondary: #3C3C43;
  --text-tertiary: #3C3C43;
  --text-quaternary: #2C2C2E;
  --text-placeholder: #3C3C43;
  
  /* Apple Accent Colors */
  --accent-blue: var(--sf-blue);
  --accent-green: var(--sf-green);
  --accent-orange: var(--sf-orange);
  
  /* Apple Shadows */
  --shadow-small: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.15);
  --shadow-large: 0 8px 24px rgba(0, 0, 0, 0.2);
  --shadow-extra-large: 0 16px 48px rgba(0, 0, 0, 0.25);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: var(--bg-primary);
  color: var(--text-primary);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 17px;
  line-height: 1.47;
  font-weight: 400;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.app {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  min-height: 100vh;
}

/* Apple-style Panels */
.panel {
  background: var(--bg-elevated);
  border-radius: 16px;
  box-shadow: var(--shadow-medium);
  overflow: hidden;
  border: 0.5px solid var(--sf-gray-2);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* Header */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  padding: 20px 24px;
  background: var(--bg-elevated);
  border-radius: 16px;
  box-shadow: var(--shadow-small);
  border: 0.5px solid var(--sf-gray-2);
}

header > div:first-child {
  display: flex;
  gap: 16px;
  align-items: center;
}

header > div:first-child > div:first-child {
  font-weight: 700;
  font-size: 24px;
  letter-spacing: -0.5px;
  color: var(--text-primary);
}

#today {
  color: var(--text-secondary);
  font-size: 16px;
  font-weight: 500;
}

/* Apple-style User Chip */
.userchip {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  border-radius: 20px;
  text-decoration: none;
  color: var(--text-primary);
  background: var(--bg-secondary);
  border: 0.5px solid var(--sf-gray-3);
  box-shadow: var(--shadow-small);
  font-weight: 600;
  font-size: 16px;
  transition: all 0.2s ease;
}

.userchip:hover {
  background: var(--sf-gray-1);
  transform: translateY(-1px);
  box-shadow: var(--shadow-medium);
}

.userchip.logged {
  background: linear-gradient(135deg, var(--accent-blue), var(--sf-blue-dark));
  color: white;
  border: none;
  box-shadow: var(--shadow-medium);
}

/* Timer Grid */
.timer-grid {
  display: grid;
  grid-template-columns: 1fr 120px;
  gap: 20px;
}

.timer {
  display: flex;
  flex-direction: column;
  gap: 24px;
  padding: 32px;
  align-items: center;
  text-align: center;
}

#selectedTaskLabel {
  color: var(--text-secondary);
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 8px;
}

.time {
  font-size: 72px;
  font-weight: 300;
  letter-spacing: -2px;
  cursor: pointer;
  color: var(--text-primary);
  font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, sans-serif;
  transition: all 0.2s ease;
}

.time:hover {
  color: var(--accent-blue);
  transform: scale(1.02);
}

.controls {
  display: flex;
  gap: 12px;
  width: 100%;
}

/* Apple-style Buttons */
.btn {
  flex: 1;
  border-radius: 12px;
  padding: 14px 20px;
  color: white;
  background: var(--accent-blue);
  border: none;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: var(--shadow-small);
}

.btn:hover {
  background: var(--sf-blue-dark);
  transform: translateY(-1px);
  box-shadow: var(--shadow-medium);
}

.btn:active {
  transform: translateY(0);
  box-shadow: var(--shadow-small);
}

.btn.ghost {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 0.5px solid var(--sf-gray-3);
}

.btn.ghost:hover {
  background: var(--sf-gray-1);
  border-color: var(--sf-gray-4);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.btn:disabled:hover {
  transform: none;
  box-shadow: var(--shadow-small);
}

/* Side Tile */
.side-tile {
  background: var(--bg-elevated);
  border: 0.5px solid var(--sf-gray-2);
  border-radius: 16px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  box-shadow: var(--shadow-small);
}

.coin-tile {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  border-radius: 12px;
  padding: 12px 8px;
  background: linear-gradient(135deg, var(--accent-green), #30B04A);
  color: white;
  font-weight: 600;
  font-size: 16px;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: var(--shadow-small);
}

.coin-tile:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-medium);
}

.tile-btn {
  width: 100%;
  height: 60px;
  border-radius: 12px;
  display: grid;
  place-items: center;
  border: 0.5px solid var(--sf-gray-3);
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 24px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: var(--shadow-small);
}

.tile-btn:hover {
  background: var(--sf-gray-1);
  transform: translateY(-1px);
  box-shadow: var(--shadow-medium);
}

.tile-btn.active {
  background: var(--accent-blue);
  color: white;
  border-color: var(--accent-blue);
  box-shadow: var(--shadow-medium);
}

/* Add Row */
.add-row {
  display: flex;
  gap: 12px;
  padding: 20px 24px;
  align-items: center;
}

.add-row input {
  flex: 1;
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 0.5px solid var(--sf-gray-3);
  border-radius: 12px;
  padding: 16px 20px;
  font-size: 16px;
  font-family: inherit;
  transition: all 0.2s ease;
}

.add-row input:focus {
  outline: none;
  border-color: var(--accent-blue);
  box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

.add-row input::placeholder {
  color: var(--text-placeholder);
}

/* List */
.list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.item {
  display: flex;
  gap: 12px;
  align-items: center;
  padding: 16px 24px;
  border-bottom: 0.5px solid var(--sf-gray-2);
  transition: all 0.2s ease;
}

.item:last-child {
  border-bottom: none;
}

.item:hover {
  background: var(--sf-gray-1);
}

.item.selected {
  background: rgba(0, 122, 255, 0.08);
  border-left: 4px solid var(--accent-blue);
}

.item input[type="checkbox"] {
  width: 20px;
  height: 20px;
  border-radius: 6px;
  border: 2px solid var(--sf-gray-4);
  background: var(--bg-secondary);
  cursor: pointer;
  transition: all 0.2s ease;
}

.item input[type="checkbox"]:checked {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
}

.item input[type="checkbox"]:checked::after {
  content: "âœ“";
  color: white;
  font-weight: bold;
  display: block;
  text-align: center;
  line-height: 16px;
}

.item > div {
  flex: 1;
  font-size: 16px;
  color: var(--text-primary);
  cursor: pointer;
}

.select-btn {
  border: 0.5px solid var(--sf-gray-3);
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: 8px 16px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.select-btn:hover {
  background: var(--sf-gray-1);
  border-color: var(--sf-gray-4);
}

/* Actions */
.actions {
  display: flex;
  gap: 12px;
  padding: 20px 24px;
}

.danger {
  background: var(--sf-red);
  color: white;
  border: none;
}

.danger:hover {
  background: #E03430;
}

/* Fullscreen */
.fs-wrap {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 60;
  background: var(--bg-primary);
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 24px;
  color: var(--text-primary);
}

.fs-wrap.show {
  display: flex;
}

.fs-time {
  font-size: 20vw;
  font-weight: 300;
  font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, sans-serif;
  letter-spacing: -4px;
}

/* Modal */
#lenModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  align-items: center;
  justify-content: center;
  z-index: 50;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

#lenModal .panel {
  width: min(400px, 90vw);
  padding: 24px;
}

#lenModal select {
  width: 100%;
  padding: 12px 16px;
  border: 0.5px solid var(--sf-gray-3);
  border-radius: 8px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 16px;
  margin-top: 8px;
}

#lenModal .panel > div:last-child {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 20px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .app {
    padding: 16px;
    gap: 16px;
  }
  
  .timer-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .side-tile {
    flex-direction: row;
    gap: 12px;
  }
  
  .coin-tile,
  .tile-btn {
    flex: 1;
  }
  
  .time {
    font-size: 48px;
  }
  
  .fs-time {
    font-size: 25vw;
  }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  :root {
    --bg-primary: #000000;
    --bg-secondary: #1C1C1E;
    --bg-tertiary: #2C2C2E;
    --bg-grouped: #000000;
    --bg-elevated: #1C1C1E;
    
    --text-primary: #FFFFFF;
    --text-secondary: #EBEBF5;
    --text-tertiary: #EBEBF5;
    --text-quaternary: #EBEBF5;
    --text-placeholder: #8E8E93;
  }
  
  .panel {
    border-color: var(--sf-gray-8);
  }
  
  .item {
    border-bottom-color: var(--sf-gray-8);
  }
}
</style>
</head>
<body>
<div class="app">
  <header>
    <div style="display:flex;gap:12px;align-items:center">
      <div style="font-weight:900;letter-spacing:.3px;text-transform:uppercase;color:#cfe7ff">Fokus Todos</div>
      <div id="today" style="color:#aac7e5;font-size:.92rem"></div>
    </div>
    <a id="loginLink" class="userchip" href="/api/auth/signin?callbackUrl=/app.html">Anmelden</a>
  </header>

  <section class="timer-grid">
    <div class="panel timer">
      <div id="selectedTaskLabel" style="color:#5a6a78">Keine Aufgabe ausgewÃ¤hlt</div>
      <div class="time" id="time" title="Zum Ã„ndern tippen">25:00</div>
      <div class="controls">
        <button class="btn" id="startBtn">Start</button>
        <button class="btn ghost" id="resetBtn" disabled>Reset</button>
      </div>
    </div>
    <aside class="side-tile">
      <button class="coin-tile" id="coinTile"><span>ðŸª™</span><span id="coinCount">0</span></button>
      <button class="tile-btn" id="fsBtn" aria-pressed="false" title="Vollbild">â›¶</button>
      <button class="tile-btn" id="awakeBtn" aria-pressed="false" title="Monitor anlassen">ðŸ”†</button>
    </aside>
  </section>

  <section class="panel add-row"><input id="taskInput" placeholder="Neue Aufgabeâ€¦"><button id="addBtn" class="btn" style="flex:0 0 46px">+</button></section>
  <section class="panel"><ul class="list" id="list"></ul></section>
  <section class="panel actions"><button class="btn ghost" id="clearDoneBtn">Erledigte entfernen</button><button class="btn danger" id="eraseAllBtn">Alles lÃ¶schen</button></section>
</div>

<div class="fs-wrap" id="fsWrap"><div id="fsTask">Fokus</div><div class="fs-time" id="fsTime">25:00</div><div style="display:flex;gap:10px"><button class="btn" id="fsStart">Start</button><button class="btn ghost" id="fsExit">Beenden</button></div></div>

<div id="lenModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);align-items:center;justify-content:center">
  <div class="panel" style="width:min(520px,92vw);padding:16px"><b>FokuslÃ¤nge (min)</b><div><select id="lenSelect"></select></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px"><button class="btn" id="lenSave">Speichern</button><button class="btn ghost" id="lenCancel">Abbrechen</button></div>
  </div>
</div>

<script>
(()=>{
 const $=s=>document.querySelector(s);
 const listEl=$("#list"),inputEl=$("#taskInput"),addBtn=$("#addBtn"),clearDoneBtn=$("#clearDoneBtn"),eraseAllBtn=$("#eraseAllBtn");
 const timeEl=$("#time"),startBtn=$("#startBtn"),resetBtn=$("#resetBtn"),selectedTaskLabel=$("#selectedTaskLabel");
 const fsBtn=$("#fsBtn"),fsWrap=$("#fsWrap"),fsTime=$("#fsTime"),fsTask=$("#fsTask"),fsStart=$("#fsStart"),fsExit=$("#fsExit");
 const loginLink=$("#loginLink"); const lenModal=$("#lenModal"),lenSelect=$("#lenSelect"),lenSave=$("#lenSave"),lenCancel=$("#lenCancel");
 const awakeBtn=$("#awakeBtn");
 const STORAGE_KEY="focusTodos.v1", SETTINGS_KEY="focusTodos.settings.v1", UI_KEY="focusTodos.ui.v1";
 let state={tasks:[],selectedId:null}; let settings={focusMinutes:25, keepAwake:false};
 let timer={running:false,remaining:25*60,intervalId:null,boundTaskId:null};
 let wakeLock=null;

 async function fetchSession(){ try{ const r=await fetch('/api/auth/session'); if(!r.ok) return; const s=await r.json(); if(s?.user){ loginLink.textContent=s.user.name||s.user.email; loginLink.classList.add('logged'); loginLink.href='/api/auth/signout?callbackUrl=/app.html'; } }catch(e){} }
 const cloud={enabled:false};
 async function cloudLoad(){ if(!cloud.enabled) return; try{ const r=await fetch('/api/tasks'); if(!r.ok) return; const d=await r.json(); state.tasks=d.tasks||[]; saveLocal(); render(); }catch(e){} }
 async function cloudCreate(t){ if(!cloud.enabled) return; fetch('/api/tasks',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(t)}); }
 async function cloudUpdate(id,updates){ if(!cloud.enabled) return; fetch('/api/tasks',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,updates})}); }
 async function cloudClearDone(){ if(!cloud.enabled) return; fetch('/api/tasks?clearDone=1',{method:'DELETE'}); }
 async function cloudEraseAll(){ if(!cloud.enabled) return; fetch('/api/tasks?eraseAll=1',{method:'DELETE'}); }

 function loadLocal(){ try{const raw=localStorage.getItem(STORAGE_KEY); if(raw) state=JSON.parse(raw);}catch(e){} try{const s=localStorage.getItem(SETTINGS_KEY); if(s) settings=Object.assign(settings,JSON.parse(s));}catch(e){} try{const u=localStorage.getItem(UI_KEY); if(u){const x=JSON.parse(u); if(x.selectedId!==undefined) state.selectedId=x.selectedId;}}catch(e){} timer.remaining=settings.focusMinutes*60; }
 function saveLocal(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(state)); localStorage.setItem(SETTINGS_KEY,JSON.stringify(settings)); localStorage.setItem(UI_KEY,JSON.stringify({selectedId:state.selectedId})); }

 const uid=()=> (Date.now().toString(36)+Math.random().toString(36).slice(2,8));
 const fmt=s=>`${Math.floor(s/60).toString().padStart(2,'0')}:${Math.floor(s%60).toString().padStart(2,'0')}`;

 function render(){
   listEl.innerHTML=""; let sel=false;
   state.tasks.forEach(t=>{
     const li=document.createElement('li'); li.className="item"+(state.selectedId===t.id?" selected":"");
     const cb=document.createElement('input'); cb.type="checkbox"; cb.checked=!!t.done; cb.onchange=()=>{t.done=cb.checked; saveLocal(); cloudUpdate(t.id,{done:t.done});};
     const label=document.createElement('div'); label.style.flex='1'; label.textContent=t.text; label.ondblclick=()=>{ const i=document.createElement('input'); i.value=t.text; i.onblur=()=>{ t.text=i.value||t.text; label.replaceWith(label); label.textContent=t.text; saveLocal(); cloudUpdate(t.id,{text:t.text}); }; label.replaceWith(i); i.focus(); };
     const selBtn=document.createElement('button'); selBtn.className='select-btn'; selBtn.textContent=(state.selectedId===t.id)?'AusgewÃ¤hlt':'Fokussieren'; selBtn.onclick=()=>{ if(timer.running&&state.selectedId!==t.id){alert('Timer lÃ¤uft â€“ erst stoppen.');return;} state.selectedId=(state.selectedId===t.id)?null:t.id; saveLocal(); render(); };
     li.append(cb,label,selBtn); listEl.appendChild(li); if(state.selectedId===t.id) sel=true;
   });
   if(!sel) state.selectedId=null;
   const t=state.tasks.find(x=>x.id===state.selectedId); selectedTaskLabel.textContent=t?`Fokus: ${t.text}`:'Keine Aufgabe ausgewÃ¤hlt'; fsTask.textContent=t? t.text:'Fokus';
 }

 function tick(){ if(!timer.running) return; timer.remaining--; if(timer.remaining<=0){ timer.running=false; clearInterval(timer.intervalId); timer.remaining=0; const t=state.tasks.find(x=>x.id===timer.boundTaskId); if(t){ t.pomodoros=(t.pomodoros||0)+1; saveLocal(); cloudUpdate(t.id,{pomodoros:t.pomodoros}); } alert('Pomodoro geschafft!'); } updateTimerUI(); }
 function updateTimerUI(){ const s=fmt(timer.remaining); timeEl.textContent=s; fsTime.textContent=s; startBtn.textContent=timer.running?'Pause':'Start'; fsStart.textContent=startBtn.textContent; resetBtn.disabled=!timer.running && (timer.remaining===settings.focusMinutes*60); }
 function openLen(){ if(timer.running) return alert('WÃ¤hrend des Fokus nicht Ã¤ndern.'); lenSelect.innerHTML=""; for(let i=1;i<=180;i++){ const o=document.createElement('option'); o.value=i; o.textContent=i; if(i===settings.focusMinutes) o.selected=true; lenSelect.appendChild(o);} lenModal.style.display='flex'; }
 function closeLen(){ lenModal.style.display='none'; }
 function start(){ if(timer.running){ timer.running=false; clearInterval(timer.intervalId); updateTimerUI(); return; } if(!state.selectedId){ const f=state.tasks.find(t=>!t.done); if(f) state.selectedId=f.id; else return alert('Erst eine Aufgabe hinzufÃ¼gen.'); } timer.boundTaskId=state.selectedId; if(timer.remaining<=0||timer.remaining>settings.focusMinutes*60) timer.remaining=settings.focusMinutes*60; timer.running=true; clearInterval(timer.intervalId); timer.intervalId=setInterval(tick,1000); updateTimerUI(); }
 function reset(){ timer.running=false; clearInterval(timer.intervalId); timer.remaining=settings.focusMinutes*60; updateTimerUI(); }

 // ---- Wake Lock (Monitor anlassen) ----
 function updateAwakeUI(){ const active = !!(wakeLock || settings.keepAwake); awakeBtn.classList.toggle('active', active); awakeBtn.setAttribute('aria-pressed', active ? 'true' : 'false'); }
 async function requestWakeLock(){
   if(!('wakeLock' in navigator)){ alert('Wake Lock wird von deinem Browser nicht unterstÃ¼tzt.'); settings.keepAwake=false; saveLocal(); updateAwakeUI(); return; }
   try{
     wakeLock = await navigator.wakeLock.request('screen');
     updateAwakeUI();
     wakeLock.addEventListener('release', ()=>{
       if(settings.keepAwake && document.visibilityState === 'visible'){ requestWakeLock(); }
       else { wakeLock=null; settings.keepAwake=false; saveLocal(); updateAwakeUI(); }
     });
   }catch(e){
     alert('Konnte Wake Lock nicht aktivieren.');
     settings.keepAwake=false; saveLocal(); updateAwakeUI();
   }
 }
 function releaseWakeLock(){ try{ if(wakeLock){ wakeLock.release(); } }catch(e){} wakeLock=null; updateAwakeUI(); }

 document.addEventListener('visibilitychange', ()=>{
   if(document.visibilityState==='visible' && settings.keepAwake && !wakeLock){ requestWakeLock(); }
 });

 // events
 addBtn.onclick=()=>{ const v=(inputEl.value||'').trim(); if(!v) return; const t={id:uid(),text=v,done:false,pomodoros:0,createdAt:Date.now()}; state.tasks.unshift(t); inputEl.value=''; saveLocal(); render(); cloudCreate(t); };
 inputEl.onkeydown=e=>{ if(e.key==='Enter') addBtn.click(); };
 clearDoneBtn.onclick=()=>{ if(!state.tasks.some(t=>t.done)) return; state.tasks=state.tasks.filter(t=>!t.done); if(!state.tasks.find(x=>x.id===state.selectedId)) state.selectedId=null; saveLocal(); render(); cloudClearDone(); };
 eraseAllBtn.onclick=()=>{ if(!confirm('Wirklich alles lÃ¶schen?')) return; state={tasks:[],selectedId:null}; saveLocal(); render(); cloudEraseAll(); };
 timeEl.onclick=openLen; lenSave.onclick=()=>{ settings.focusMinutes=parseInt(lenSelect.value,10)||25; saveLocal(); timer.remaining=settings.focusMinutes*60; closeLen(); updateTimerUI(); }; lenCancel.onclick=closeLen;
 startBtn.onclick=start; fsStart.onclick=start; resetBtn.onclick=reset;
 fsBtn.onclick=()=>{ fsWrap.classList.contains('show') ? (fsWrap.classList.remove('show')) : fsWrap.classList.add('show'); }; fsExit.onclick=()=>fsWrap.classList.remove('show');
 awakeBtn.onclick=async()=>{
   if(settings.keepAwake || wakeLock){ settings.keepAwake=false; saveLocal(); releaseWakeLock(); }
   else { settings.keepAwake=true; saveLocal(); await requestWakeLock(); }
   updateAwakeUI();
 };

 (async function init(){
   const now=new Date(); $("#today").textContent=new Intl.DateTimeFormat('de-DE',{weekday:'long',day:'2-digit',month:'long',year:'numeric'}).format(now);
   for(let i=1;i<=180;i++){ const o=document.createElement('option'); o.value=i; o.textContent=i; lenSelect.appendChild(o); }
   loadLocal(); updateTimerUI(); render();
   await fetchSession(); await cloudLoad();
   updateAwakeUI();
   if(settings.keepAwake) requestWakeLock();
 })();
})();
</script>
</body>
</html>
